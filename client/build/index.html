<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="Customer Copilot Query Interface" />
    <title>Customer Copilot Query Interface</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@tanstack/react-query@5/build/umd/index.production.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif; }
      .container { max-width: 1024px; margin: 0 auto; padding: 1.5rem; }
      .card { background: white; border-radius: 0.5rem; border: 1px solid #e5e7eb; box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1); padding: 1.5rem; margin-bottom: 1rem; }
      .card-header { margin-bottom: 1rem; }
      .card-title { font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem; }
      .input { width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.375rem; font-size: 0.875rem; }
      .input:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 0 3px rgb(59 130 246 / 0.1); }
      .button { background: #3b82f6; color: white; padding: 0.5rem 1rem; border: none; border-radius: 0.375rem; cursor: pointer; font-size: 0.875rem; margin-left: 0.5rem; }
      .button:hover { background: #2563eb; }
      .button:disabled { background: #9ca3af; cursor: not-allowed; }
      .badge { background: #f3f4f6; color: #374151; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem; display: inline-block; margin-right: 0.5rem; }
      .error { background: #fef2f2; border: 1px solid #fecaca; color: #dc2626; padding: 0.75rem; border-radius: 0.375rem; margin: 1rem 0; }
      .response { white-space: pre-wrap; line-height: 1.6; margin: 1rem 0; }
      .metadata { color: #6b7280; font-size: 0.875rem; margin-bottom: 0.5rem; }
      .copy-btn { background: #f9fafb; border: 1px solid #d1d5db; color: #374151; padding: 0.25rem 0.5rem; font-size: 0.75rem; }
      .copy-btn:hover { background: #f3f4f6; }
    </style>
  </head>
  <body>
    <div id="root">
      <div class="container">
        <div class="card">
          <div class="card-header">
            <div class="card-title">Customer Copilot Query Interface</div>
          </div>
          <form id="queryForm">
            <div style="display: flex; align-items: center;">
              <input 
                type="text" 
                id="queryInput" 
                class="input" 
                placeholder="Ask a question about customer calls..."
                style="flex: 1;"
              />
              <button type="submit" id="submitBtn" class="button">Submit</button>
            </div>
            <div id="error" class="error" style="display: none;"></div>
          </form>
        </div>
        <div id="results" style="display: none;">
          <h2 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem;">Query Results</h2>
          <div id="resultsContainer"></div>
        </div>
      </div>
    </div>

    <script>
      let results = [];
      const form = document.getElementById('queryForm');
      const input = document.getElementById('queryInput');
      const button = document.getElementById('submitBtn');
      const errorDiv = document.getElementById('error');
      const resultsDiv = document.getElementById('results');
      const resultsContainer = document.getElementById('resultsContainer');

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const query = input.value.trim();
        if (!query) return;

        button.textContent = 'Processing...';
        button.disabled = true;
        input.disabled = true;
        errorDiv.style.display = 'none';

        try {
          const response = await fetch('/api/query', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ query })
          });

          const data = await response.json();
          
          if (data.error) {
            errorDiv.textContent = data.error;
            errorDiv.style.display = 'block';
          } else {
            const result = { ...data, id: Date.now(), query };
            results.push(result);
            renderResults();
            input.value = '';
          }
        } catch (err) {
          errorDiv.textContent = `Error: ${err.message}`;
          errorDiv.style.display = 'block';
        }

        button.textContent = 'Submit';
        button.disabled = false;
        input.disabled = false;
      });

      function renderResults() {
        if (results.length === 0) return;
        
        resultsDiv.style.display = 'block';
        resultsContainer.innerHTML = results.map(result => `
          <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.5rem;">
              <div style="font-weight: 600; font-size: 1.125rem;">${escapeHtml(result.query)}</div>
              <button class="copy-btn" onclick="copyText('${escapeHtml(result.response)}')">Copy</button>
            </div>
            <div class="metadata">
              <span class="badge">${result.metadata.responseTime.toFixed(2)}s</span>
              <span>${new Date(result.metadata.timestamp).toLocaleString()}</span>
            </div>
            ${result.error ? 
              `<div class="error">${escapeHtml(result.error)}</div>` :
              `<div class="response">${escapeHtml(result.response)}</div>`
            }
          </div>
        `).join('');
      }

      function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }

      function copyText(text) {
        navigator.clipboard.writeText(text).then(() => {
          // Could add a toast notification here
        }).catch(err => {
          console.error('Failed to copy:', err);
        });
      }

      // Enable submit on input
      input.addEventListener('input', () => {
        button.disabled = !input.value.trim();
      });
    </script>
  </body>
</html>